<html>
<head>
<script type="text/javascript" src="src/genericutils.js"></script>
<script type="text/javascript">
// http://wiki.dominionstrategy.com/index.php/List_of_cards

function getCards() {
	let getCardsXhr = new XMLHttpRequest();
	getCardsXhr.open("GET", "https://cors-anywhere.herokuapp.com/http://wiki.dominionstrategy.com/index.php/List_of_cards");
	getCardsXhr.responseType = "document";
	getCardsXhr.onload = (document) => {
		let rows = document.srcElement.response.body.querySelectorAll("tr");
		let cards = [];
		rows.forEach((row, idx) => {
			if(idx === 0)
				return;
			let cells = row.children;
			let card = {};
			let costSrc = cells[3] != null ? cells[3].children.length > 0 ? cells[3].children[0].children[0].src : "" : "";
			card.name = cells[0] != null ? cells[0].textContent.trim() : "";
			card.set = cells[1] != null ? cells[1].textContent.trim() : "";
			card.types = cells[2] != null ? cells[2].textContent.trim() : "";
			card.costSrc = costSrc;
			card.cost = costSrc != null ? parseInt(costSrc[costSrc.lastIndexOf("Coin")+4], 10) : "";
			card.text = cells[4] != null ? cells[4].textContent.trim() : "";
			card.actions = cells[5] != null ? cells[5].textContent.trim() : "";
			card.cards = cells[6] != null ? cells[6].textContent.trim() : "";
			card.buys = cells[7] != null ? cells[7].textContent.trim() : "";
			card.coins = cells[8] != null ? cells[8].textContent.trim() : "";
			card.trash = cells[9] != null ? cells[9].textContent.trim() : "";
			card.junk = cells[10] != null ? cells[10].textContent.trim() : "";
			card.gain = cells[11] != null ? cells[11].textContent.trim() : "";
			card.points = cells[12] != null ? cells[12].textContent.trim() : "";
			cards.push(card);
		});
		let json = JSON.stringify(cards, null, "/t");
		download(json, "DominionCards", ".json");
		document.querySelector("#data").textContent = json;
	};
	getCardsXhr.send();
}

getCards();
</script>
</head>
<body>
	<div id="data"/>
</body>
</html>